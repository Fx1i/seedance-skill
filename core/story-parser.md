# 智能剧情解析算法

## 功能概述

将用户的自然语言剧情描述进行语义分析，提取关键要素并建立结构化时间线。

## 核心任务

1. **语义分析**：理解剧情描述的语言结构和语义含义
2. **要素提取**：识别角色、场景、动作、时间等关键信息
3. **时间线构建**：按叙事顺序排列事件
4. **段落识别**：检测自然段落和情节点

## 处理流程

```
输入：自然语言剧情描述
    ↓
步骤1：语义分析
    - 分析句子结构
    - 识别语义单元
    - 理解因果关系
    ↓
步骤2：要素提取
    - 角色（Who）：识别主要角色和对象
    - 场景（Where）：提取地点和环境信息
    - 动作（What）：识别主要动作和事件
    - 时间（When）：提取时间信息
    - 情感（Feeling）：识别情绪和氛围
    ↓
步骤3：时间线构建
    - 按叙事顺序排列事件
    - 建立事件间的关系
    - 识别时间跳跃和场景转换
    ↓
步骤4：段落识别
    - 检测自然段落
    - 识别情节点和转折
    - 标记叙事结构元素
    ↓
输出：结构化剧情数据
```

## 要素提取规则

### 角色识别
- 专有名词（人名、角色名）
- 代词指代关系
- 描述性称呼（"一个女孩"、"老人"等）

### 场景识别
- 地点名称（"公园"、"房间"等）
- 环境描述（"海边"、"山顶"等）
- 时间相关场景（"白天"、"夜晚"）

### 动作识别
- 动词短语
- 动作序列（识别连续动作）
- 互动动作（涉及多个角色或对象）

### 时间信息
- 明确时间（"早上"、"晚上"）
- 相对时间（"然后"、"接着"）
- 时间跳跃（"第二天"、"一年后"）

### 情感识别
- 直接情感描述（"快乐"、"悲伤"）
- 通过动作表达的情感
- 环境暗示的情感

## 时间线构建

### 事件排序
1. 按文本顺序排列
2. 考虑时间标记（"然后"、"同时"等）
3. 识别因果关系链

### 关系标记
- 顺序关系（事件A → 事件B）
- 同时关系（事件A ∥ 事件B）
- 因果关系（事件A → 事件B，原因→结果）

## 段落识别

### 自然段落检测
- 标点符号边界（句号、问号）
- 段落换行
- 时间跳跃标记
- 场景变化描述

### 情节点识别
- 转折标记（"突然"、"然而"）
- 冲突或问题出现
- 解决方案的出现
- 情感变化点

## 输出格式

### 结构化数据格式

```
事件 [编号]：
- 角色：[角色列表]
- 场景：[地点/环境]
- 动作：[主要动作]
- 时间：[时间信息]
- 情感：[情感描述]
- 关系：[与前/后事件的关系]
- 备注：[其他信息]
```

### 完整时间线

```
时间线：
1. 事件1 → 事件2 → 事件3 → 事件4
```

## 示例

### 输入
"一个女孩在海边看日落，然后转身跑回家"

### 处理过程
1. **语义分析**：识别两个语义单元
2. **要素提取**：
   - 事件1：角色=女孩，场景=海边，动作=看日落，时间=日落时分
   - 事件2：角色=女孩，场景=海边→回家的路，动作=转身跑，时间=接着
3. **时间线构建**：事件1 → 事件2
4. **段落识别**：通过"然后"识别为两个段落

### 输出
```
事件1：
- 角色：一个女孩
- 场景：海边
- 动作：看日落
- 时间：日落时分
- 情感：宁静、观赏
- 关系：起始事件
- 备注：静态场景

事件2：
- 角色：一个女孩
- 场景：海边→回家的路
- 动作：转身跑
- 时间：接着（日落时分后）
- 情感：动态、离开
- 关系：事件1的后继事件
- 备注：动态动作，场景转换
```

## 注意事项

1. **角色指代处理**：正确处理代词指代关系（"她"→"女孩"）
2. **动作完整性**：保持动作序列的完整性
3. **场景连续性**：识别场景变化但不破坏叙事流畅性
4. **时间逻辑**：确保时间线的逻辑一致性
5. **歧义处理**：对于模糊描述，保持原始信息不变