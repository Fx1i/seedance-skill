# 分镜稿+提示词生成

## 功能概述

基于剧情解析和语义分割的结果，为每个片段生成结构化分镜稿和优化的AI视频提示词。

## 标准输出格式

每个片段输出包含以下信息：

```
片段 [编号]：
- 预估时长：[X]秒
- 场景：[地点/环境]
- 主体：[主要角色/对象]
- 动作：[主要动作]
- 机位：[镜头类型+运动]
- 风格：[视觉风格+光线]
- 备注：[连贯性要点]
- AI提示词：[生成的英文提示词]
```

## 生成流程

```
输入：剧情解析数据 + 语义分割结果
    ↓
步骤1：分析片段信息
    - 提取场景、主体、动作
    - 识别情感氛围
    ↓
步骤2：设计镜头
    - 选择镜头类型
    - 确定镜头运动
    ↓
步骤3：确定风格
    - 视觉风格
    - 光线设置
    ↓
步骤4：生成分镜稿
    - 填充标准格式
    - 添加备注信息
    ↓
步骤5：生成AI提示词
    - 应用通用公式
    - 优化表达方式
    ↓
步骤6：连贯性检查
    - 检查片段间一致性
    - 添加连贯性要点
    ↓
输出：完整分镜稿 + AI提示词
```

## 分镜稿生成规则

### 场景描述
**规则**：
- 提取场景信息（地点、环境、时间）
- 保持简洁明确
- 包含必要的视觉元素

**示例**：
- 输入："海边日落时分"
- 输出："海边，日落时分，温暖光线"

### 主体识别
**规则**：
- 识别主要角色或对象
- 保持一致性（使用相同称呼）
- 包含必要的特征描述

**示例**：
- 输入："一个穿着红色运动服的女孩"
- 输出："穿着红色运动服的女孩"

### 动作描述
**规则**：
- 提取主要动作
- 保持动作连贯性
- 使用动作动词

**示例**：
- 输入："跑"
- 输出："跑向远方"

### 镜头选择
**原则**：
- 根据动作类型选择合适镜头
- 考虑情感表达需求
- 保持视觉连贯性

**选择参考**（基于基础镜头类型）：
```
静态场景：固定镜头（Fixed Shot）
- 示例："固定镜头，中景"

动态跟随：跟拍（Tracking Shot）
- 示例："跟拍，平滑移动"

情感表达：特写（Close-up）
- 示例："特写，聚焦表情"

环境展示：全景（Wide Shot）
- 示例："全景，展现环境"

强调重要性：推镜（Dolly In）
- 示例："缓慢推镜"

创造距离感：拉镜（Dolly Out）
- 示例："缓慢拉镜"
```

### 风格确定
**风格要素**：
1. 视觉风格：写实/电影感/动画风格
2. 光线：自然光/人工光/特殊光线
3. 氛围：温暖/冷峻/神秘/欢快

**风格映射**：
```
情感→风格
宁静→温暖柔和
紧张→戏剧性强
悲伤→冷色调
欢快→明亮活泼
神秘→神秘朦胧
```

## AI提示词生成

### 通用公式

```
主体 + 场景 → 动作 → 机位 → 风格/光线 → 节奏/约束
```

### 生成规则

**1. 主体 + 场景**
- 英文翻译
- 保持简洁
- 包含关键特征

**2. 动作**
- 使用动词
- 保持动作明确
- 单一主要动作

**3. 机位**
- 镜头类型（英文）
- 运动方式（smooth/dynamic/static）
- 镜头角度（如有必要）

**4. 风格/光线**
- 视觉风格词
- 光线描述
- 氛围词

**5. 节奏/约束**
- 运动节奏（smooth/dynamic）
- 镜头约束（single continuous shot）
- 负向提示（如需要）

### 示例生成

**输入分镜稿**：
```
片段1：
- 预估时长：5秒
- 场景：海边日落
- 主体：女孩
- 动作：看日落
- 机位：固定镜头
- 风格：温暖柔和
```

**生成过程**：
1. 主体 + 场景："A young girl at the beach during sunset"
2. 动作："watching the sunset"
3. 机位："fixed shot"
4. 风格/光线："warm soft lighting, peaceful atmosphere"
5. 节奏/约束："single continuous shot"

**输出AI提示词**：
```
"A young girl at the beach during sunset watching the sunset, fixed shot, warm soft lighting, peaceful atmosphere, single continuous shot"
```

## 连贯性管理

### 片段间连贯性检查

**检查点**：
1. 角色一致性
   - 服装、外观是否一致
   - 位置关系是否合理

2. 场景连续性
   - 场景转换是否自然
   - 光线是否合理

3. 动作连贯性
   - 动作过渡是否流畅
   - 方向是否一致

4. 视觉风格一致性
   - 风格是否统一
   - 色调是否协调

### 连贯性要点标注

在"备注"字段添加连贯性要点：
```
- 备注："保持红色运动服，面向同一方向"
- 备注："光线从日落过渡到黄昏"
- 备注："保持奔跑动作流畅"
```

## 输出示例

### 完整示例

**输入**：剧情描述 "一个女孩在海边看日落，然后转身跑回家"

**输出**：

```
片段1：
- 预估时长：5秒
- 场景：海边，日落时分
- 主体：穿着红色运动服的女孩
- 动作：看日落，静静站立
- 机位：中景，固定镜头
- 风格：温暖柔和，黄金时刻光线
- 备注：营造宁静氛围，面向大海方向
- AI提示词："A girl in red sportswear standing at the beach watching sunset, medium shot fixed, warm soft lighting, golden hour, peaceful atmosphere"

片段2：
- 预估时长：6秒
- 场景：海边，同一位置
- 主体：穿着红色运动服的女孩
- 动作：转身，开始跑
- 机位：跟拍，平滑移动
- 风格：温暖，动态感
- 备注：保持红色运动服，转身动作流畅
- AI提示词："The girl in red sportswear turns around and starts running, smooth tracking shot following her movement, warm lighting, dynamic motion"

片段3：
- 预估时长：6秒
- 场景：沿海道路
- 主体：穿着红色运动服的女孩
- 动作：跑向远方
- 机位：侧后方跟拍
- 风格：温暖渐暗，黄昏光线
- 备注：保持红色运动服，奔跑姿势一致
- AI提示词："The girl in red sportswear running along the coastal road, side-angle tracking shot, warm dusk lighting, energetic motion, single continuous shot"
```

## 优化技巧

### 提示词优化

1. **保持简洁**：避免冗余描述
2. **明确主体**：清晰定义主要对象
3. **单一动作**：每个片段聚焦一个主要动作
4. **风格统一**：保持风格描述的一致性
5. **节奏明确**：指定运动节奏（smooth/dynamic）

### 连贯性优化

1. **使用参考素材**：对于重要角色或场景，使用@AssetName引用
2. **明确约束**：在提示词中添加一致性约束
3. **视觉锚点**：在相邻片段间建立视觉联系

## 注意事项

1. **时长估算**：提示词应与预估时长匹配
2. **动作可行性**：确保动作在指定时长内可完成
3. **风格一致性**：保持视觉风格在片段间协调
4. **镜头合理性**：镜头选择应适合动作类型
5. **AI生成特性**：考虑AI视频生成的特点和限制